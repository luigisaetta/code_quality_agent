# `run_agent.py`

## Overview
- Provides a **CLI entry‑point** that drives the graph‑based analysis agent.  
- Accepts a **root directory** (read‑only) containing Python files and an **output directory** for generated artifacts.  
- Builds a processing graph via `agent.graph_agent.build_graph`.  
- Executes the agent asynchronously with `agent.graph_agent.run_agent`, passing the user request (default: “Check only headers and scan secrets…”).  
- Prints a concise **summary**, any **header issues**, and any **secrets** discovered by the agent.  

## Public API
The script is intended to be executed as a program; the only import‑able symbol is:

- `main()` – callable entry point (also invoked when the module is run as `__main__`).

## Key Behaviors and Edge Cases
| Behavior | Details |
|----------|---------|
| **Argument parsing** | Uses `argparse` with three required/optional flags: `--root`, `--out`, and `--request`. Missing required flags cause the script to exit with a usage message. |
| **Graph construction** | Calls `build_graph()` **once** before the async run; any failure propagates as an exception. |
| **Async execution** | Wraps `run_agent` in an inner coroutine `_run()` and executes it via `asyncio.run`. Errors inside `run_agent` will abort the script unless caught inside the agent implementation. |
| **Result handling** | Expects `run_agent` to return a dict with keys `summary`, `header_issues`, and `secrets`. Missing keys raise a `KeyError`. |
| **Printing** | Formats findings with simple `print` statements; no logging level control beyond the console logger used for internal agent messages. |
| **Edge cases** | - Empty `header_issues` or `secrets` sections are silently skipped. <br>- If the output directory does not exist, the agent may fail when trying to write artifacts (depends on `run_agent` implementation). |

## Inputs / Outputs / Side Effects
| Item | Description |
|------|-------------|
| **Inputs** | `--root` (path to source tree, read‑only), `--out` (path where the agent writes artifacts), `--request` (free‑form text describing the analysis request). |
| **Outputs** | - Console output: summary, header issues, and secret findings. <br>- Files written to the `--out` directory (generated by the agent). |
| **Side Effects** | - Reads files under `--root`. <br>- Writes to `--out`. <br>- Emits log messages via `agent.utils.get_console_logger`. |

## Usage Examples
```bash
# Basic usage – check headers and scan for secrets
python run_agent.py --root ./my_project/src --out ./analysis_output

# Custom request text
python run_agent.py \
    --root ./my_project/src \
    --out ./analysis_output \
    --request "Identify all functions lacking type hints and flag any hard‑coded passwords."
```

## Risks / TODOs
- **No secrets detected** in the source code of this script.  
- The script assumes the output directory exists and is writable; consider adding a check/creation step.  
- No explicit error handling around `run_agent`; unexpected exceptions will terminate the program.  
- Logging is limited to the console logger; a more configurable logging setup could be beneficial for production use.
